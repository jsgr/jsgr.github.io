<!DOCTYPE html>
<html lang="zh-Hans">
<head>

    <!--[if lt IE 9]>
        <style>body {display: none; background: none !important} </style>
        <meta http-equiv="Refresh" Content="0; url=//outdatedbrowser.com/" />
    <![endif]-->

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="format-detection" content="telephone=no" />
<meta name="author" content="jsgr" />



<meta name="description" content="在动笔写这篇文章之前，我得先忏悔一下：在很长一段时间里我对Unicode充满了恐惧。
每次遇到需要Unicode知识的编程问题时，我总是找一个hack方案来解决，但解决方案的原理我也不懂。
直到遇见一个需要深入了解Unicode知识才能解决的问题，我才停止了这种逃避。因为这个问题没办法应用特定情境的解决方案。">
<meta property="og:type" content="article">
<meta property="og:title" content="每个JavaScript开发者都该懂的Unicode">
<meta property="og:url" content="http://jsgrblog.win/2016/12/11/每个JavaScript开发者都该懂的Unicode/index.html">
<meta property="og:site_name" content="jsgr blog">
<meta property="og:description" content="在动笔写这篇文章之前，我得先忏悔一下：在很长一段时间里我对Unicode充满了恐惧。
每次遇到需要Unicode知识的编程问题时，我总是找一个hack方案来解决，但解决方案的原理我也不懂。
直到遇见一个需要深入了解Unicode知识才能解决的问题，我才停止了这种逃避。因为这个问题没办法应用特定情境的解决方案。">
<meta property="og:image" content="http://s2.qhimg.com/static/1b0b41c029b3aafd.svg">
<meta property="og:image" content="http://p0.qhimg.com/t0111a133814cbe5ae1.png">
<meta property="og:image" content="http://p3.qhimg.com/t012c1af4e49cc76519.png">
<meta property="og:image" content="http://p5.qhimg.com/t0198d5591a698acbde.png">
<meta property="og:updated_time" content="2016-12-11T03:30:21.176Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="每个JavaScript开发者都该懂的Unicode">
<meta name="twitter:description" content="在动笔写这篇文章之前，我得先忏悔一下：在很长一段时间里我对Unicode充满了恐惧。
每次遇到需要Unicode知识的编程问题时，我总是找一个hack方案来解决，但解决方案的原理我也不懂。
直到遇见一个需要深入了解Unicode知识才能解决的问题，我才停止了这种逃避。因为这个问题没办法应用特定情境的解决方案。">
<meta name="twitter:image" content="http://s2.qhimg.com/static/1b0b41c029b3aafd.svg">

<link rel="apple-touch-icon" href= "/apple-touch-icon.png">


    <link rel="alternate" href="/atom.xml" title="jsgr blog" type="application/atom+xml">



    <link rel="shortcut icon" href="/favicon.ico">



    <link href="//cdn.bootcss.com/animate.css/3.5.1/animate.min.css" rel="stylesheet">



    <link href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.css" rel="stylesheet">



    <script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
    <link href="//cdn.bootcss.com/pace/1.0.2/themes/blue/pace-theme-minimal.css" rel="stylesheet">


<link rel="stylesheet" href="/css/style.css">



<link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">


<title>每个JavaScript开发者都该懂的Unicode | jsgr blog</title>

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>
<script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"></script>

<script>
    var yiliaConfig = {
        fancybox: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        fancybox_js: "//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.min.js",
        scrollreveal: "//cdn.bootcss.com/scrollReveal.js/3.1.4/scrollreveal.min.js",
        search: true
    }
</script>


    <script>
        yiliaConfig.jquery_ui = [true, "//cdn.bootcss.com/jqueryui/1.10.4/jquery-ui.min.js", "//cdn.bootcss.com/jqueryui/1.10.4/css/jquery-ui.min.css"];
    </script>



    <script> yiliaConfig.rootUrl = "\/";</script>






</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
    <header id="header" class="inner">
        <a href="/" class="profilepic">
            <img src="/img/logo.jpg" class="animated zoomIn">
        </a>
        <hgroup>
          <h1 class="header-author"><a href="/">jsgr</a></h1>
        </hgroup>

        
        <p class="header-subtitle">我胡扯起来，连我自己都怕</p>
        

        
            <form id="search-form">
            <input type="text" id="local-search-input" name="q" placeholder="search..." class="search form-control" autocomplete="off" autocorrect="off" searchonload="false" />
            <i class="fa fa-times" onclick="resetSearch()"></i>
            </form>
            <div id="local-search-result"></div>
            <p class='no-result'>No results found <i class='fa fa-spinner fa-pulse'></i></p>
        


        
            <div id="switch-btn" class="switch-btn">
                <div class="icon">
                    <div class="icon-ctn">
                        <div class="icon-wrap icon-house" data-idx="0">
                            <div class="birdhouse"></div>
                            <div class="birdhouse_holes"></div>
                        </div>
                        <div class="icon-wrap icon-ribbon hide" data-idx="1">
                            <div class="ribbon"></div>
                        </div>
                        
                        <div class="icon-wrap icon-link hide" data-idx="2">
                            <div class="loopback_l"></div>
                            <div class="loopback_r"></div>
                        </div>
                        
                        
                        <div class="icon-wrap icon-me hide" data-idx="3">
                            <div class="user"></div>
                            <div class="shoulder"></div>
                        </div>
                        
                    </div>
                    
                </div>
                <div class="tips-box hide">
                    <div class="tips-arrow"></div>
                    <ul class="tips-inner">
                        <li>菜单</li>
                        <li>标签</li>
                        
                        <li>友情链接</li>
                        
                        
                        <li>关于我</li>
                        
                    </ul>
                </div>
            </div>
        

        <div id="switch-area" class="switch-area">
            <div class="switch-wrap">
                <section class="switch-part switch-part1">
                    <nav class="header-menu">
                        <ul>
                        
                            <li><a href="/">主页</a></li>
                        
                            <li><a href="/archives/">所有文章</a></li>
                        
                            <li><a href="/tags/">标签云</a></li>
                        
                            <li><a href="/about/">关于我</a></li>
                        
                        </ul>
                    </nav>
                    <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" href="mailto:1256961638@qq.com" title="Email"></a>
                            
                                <a class="fa GitHub" href="/jsgr.dithub.io" title="GitHub"></a>
                            
                                <a class="fa QQ" href="/1256961638" title="QQ"></a>
                            
                        </ul>
                    </nav>
                </section>
                
                
                <section class="switch-part switch-part2">
                    <div class="widget tagcloud" id="js-tagcloud">
                        <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS/">CSS</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS动画/">CSS动画</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS单位/">CSS单位</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS变量/">CSS变量</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS定位/">CSS定位</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS技巧/">CSS技巧</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS资源/">CSS资源</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/CSS预处理/">CSS预处理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/H5/">H5</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Jquery/">Jquery</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/">web</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/全栈/">全栈</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/动画/">动画</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/博客/">博客</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/转载/">转载</a></li></ul>
                    </div>
                </section>
                
                
                
                <section class="switch-part switch-part3">
                    <div id="js-friends">
                    
                      <a class="main-nav-link switch-friends-link" href="https://hexo.io">Hexo</a>
                    
                      <a class="main-nav-link switch-friends-link" href="https://pages.github.com/">GitHub</a>
                    
                    </div>
                </section>
                

                
                
                <section class="switch-part switch-part4">
                
                    <div id="js-aboutme">就是个人</div>
                </section>
                
            </div>
        </div>
    </header>                
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
      <div class="overlay">
          <div class="slider-trigger"></div>
          <h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">jsgr</a></h1>
      </div>
    <div class="intrude-less">
        <header id="header" class="inner">
            <a href="/" class="profilepic">
                <img src="/img/logo.jpg" class="animated zoomIn">
            </a>
            <hgroup>
              <h1 class="header-author"><a href="/" title="回到主页">jsgr</a></h1>
            </hgroup>
            
            <p class="header-subtitle">我胡扯起来，连我自己都怕</p>
            
            <nav class="header-menu">
                <ul>
                
                    <li><a href="/">主页</a></li>
                
                    <li><a href="/archives/">所有文章</a></li>
                
                    <li><a href="/tags/">标签云</a></li>
                
                    <li><a href="/about/">关于我</a></li>
                
                <div class="clearfix"></div>
                </ul>
            </nav>
            <nav class="header-nav">
                        <ul class="social">
                            
                                <a class="fa Email" target="_blank" href="mailto:1256961638@qq.com" title="Email"></a>
                            
                                <a class="fa GitHub" target="_blank" href="/jsgr.dithub.io" title="GitHub"></a>
                            
                                <a class="fa QQ" target="_blank" href="/1256961638" title="QQ"></a>
                            
                        </ul>
            </nav>
        </header>                
    </div>
    <link class="menu-list" tags="标签" friends="友情链接" about="关于我"/>
</nav>
      <div class="body-wrap"><article id="post-每个JavaScript开发者都该懂的Unicode" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/12/11/每个JavaScript开发者都该懂的Unicode/" class="article-date">
      <time datetime="2016-12-11T03:28:07.000Z" itemprop="datePublished">2016-12-11</time>
</a>


    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      每个JavaScript开发者都该懂的Unicode
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
    <div class="article-category tagcloud">
    <a class="article-category-link" href="/categories/转载/">转载</a>
    </div>


        
    <div class="article-tag tagcloud">
        <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/转载/">转载</a></li></ul>
    </div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
          
        <p>在动笔写这篇文章之前，我得先忏悔一下：在很长一段时间里我对Unicode充满了恐惧。</p>
<p>每次遇到需要Unicode知识的编程问题时，我总是找一个hack方案来解决，但解决方案的原理我也不懂。</p>
<p>直到遇见一个需要深入了解Unicode知识才能解决的问题，我才停止了这种逃避。因为这个问题没办法应用特定情境的解决方案。</p>
<a id="more"></a>
<p>在努力读了一大堆文章之后，我惊讶地发现Unicode并不难懂。好吧，确实是有些文章起码得看3遍才能看懂。</p>
<p>但我发现Unicode标准不仅世界通用，而且十分优雅简洁，只不过要理解其中一些抽象概念有点困难。</p>
<p>如果你觉得理解Unicode很难，那么是时候来面对它了！其实它没你想的那么难。去沏一杯香浓的茶或咖啡吧☕，让我们进入<strong>抽象概念</strong>、<strong>字符</strong>、<strong>星光平面(辅助平面)</strong>和<strong>代理对</strong>的世界。</p>
<p>本文首先会解释Unicode中的基本概念，这是必需的背景知识。</p>
<p>然后会说明JavaScript如何解析Unicode，以及你可能踩到哪些坑。</p>
<p>你还会学到如何利用ECMAScript 2015的新特性来解决部分难题。</p>
<p>准备好了？那就燥起来吧!</p>
<p>目录：</p>
<p>1  Unicode背后的思想</p>
<p>2 Unicode基本概念</p>
<ul>
<li><p>2.1 字符与代码点</p>
</li>
<li><p>2.2 Unicode平面</p>
</li>
<li><p>2.3 码元</p>
</li>
<li><p>2.4 代理对</p>
</li>
<li><p>2.5 组合用字符</p>
</li>
</ul>
<p>3 JavaScript中的Unicode </p>
<ul>
<li><p>3.1 转义序列</p>
</li>
<li><p>3.2 字符串比较</p>
</li>
<li><p>3.3 字符串长度</p>
</li>
<li><p>3.4 字符定位</p>
</li>
<li><p>3.5 正则匹配</p>
</li>
</ul>
<p>4 结语</p>
<h1 id="1-Unicode背后的思想"><a href="#1-Unicode背后的思想" class="headerlink" title="1. Unicode背后的思想"></a>1. Unicode背后的思想</h1><p>首先问一个最基础的问题：你是怎样阅读并理解这篇文章的？答案很简单，因为你明白这些字以及由字组成的单词的含义。</p>
<p>那你又是如何明白这些字的含义的呢？答案也很简单，因为你（读者）和我（作者）对于这些（呈现在屏幕上的）图形与汉字（即含义）之间的联系有着相同的认知。</p>
<p>对计算机来说这个原理也差不多，只有一点不同：计算机不懂这些字（字母）的含义，只是将其理解为特定的比特序列。</p>
<p>让我们设想一个情景：计算机<em>User1</em>向计算机<em>User2</em>发送一条消息<code>&#39;hello&#39;</code>。</p>
<p>计算机并不知道这些字母的含义。所以计算机<em>User1</em>将消息<code>&#39;hello&#39;</code>转换为一串数字序列<code>0x68 0x65 0x6C 0x6C 0x6F</code>，每个字母对应一个数字：<code>h</code>对应<code>0x68</code>, <code>e</code>对应<code>0x65</code>，等等。</p>
<p>接着将这些数字发送给计算机<em>User2</em>。</p>
<p>计算机<em>User2</em>收到数字序列<code>0x68 0x65 0x6C 0x6C 0x6F</code>后，使用同一套字母与数字的对应关系重建消息内容，<code>&#39;hello&#39;</code>就能正确地显示出来了。</p>
<p>不同计算机之间对字母与数字之间对应关系的协议就是<strong>Unicode</strong>进行标准化的结果。</p>
<p>根据Unicode，<code>h</code>是一个名为<em>LATIN SMALL LETTER H</em>的抽象字符。这个抽象字符对应数字<code>0x68</code>，也就是一个标记为<code>U+0068</code>的代码点。这些概念将在下一章中说明。</p>
<p>Unicode的作用就是提供一个抽象字符列表（字符集），并给每一个字符分配一个独一无二的标识符代码点（编码字符集）。</p>
<h1 id="2-Unicode基本概念"><a href="#2-Unicode基本概念" class="headerlink" title="2. Unicode基本概念"></a>2. Unicode基本概念</h1><p><a href="http://unicode.org" target="_blank" rel="external"><code>www.unicode.org</code></a>网站提到：</p>
<blockquote>
<p><strong>Unicode</strong>为每一个字符分配一个专有的数字</p>
<p>不分平台</p>
<p>不分程序</p>
<p>不分语言</p>
</blockquote>
<p>Unicode是一个世界通用的字符集，它定义了全世界大部分书写体系的字符集，并为每一个字符分配了一个独一无二的数字（代码点）。</p>
<p><img src="http://s2.qhimg.com/static/1b0b41c029b3aafd.svg" alt="Unicode logo"></p>
<p>Unicode囊括了大部分现代语言、标点符号、附加符号（变音符）、数学符号、技术符号、箭头和表情符号等。</p>
<p>Unicode第一版1.0于1991年10月发布，包含7161个字符。最新版9.0（2016年6月发布）则提供了128172个字符的编码。</p>
<p>Unicode的通用性与开放性解决了过去一直存在的一个问题：供应商们各自实现不同的字符集和编码规则，很难处理。</p>
<p>创建一个支持所有字符集和编码规则的应用是十分复杂的。更不用说你选用的编码可能不支持所有你需要的语言。</p>
<p>如果你觉得Unicode很难，那就想想如果没有它编程会更难。</p>
<p>我还记得从前随机选择所需的字符集和编码规则去读取文件内容的时候。全靠人品啊！</p>
<h2 id="2-1-字符与代码点"><a href="#2-1-字符与代码点" class="headerlink" title="2.1 字符与代码点"></a>2.1 字符与代码点</h2><blockquote>
<p><strong>抽象字符</strong>（即文本字符）是用来组织、管理或表现文本数据的信息单位。</p>
</blockquote>
<p>Unicode中的字符是一个抽象概念。每一个抽象字符都有一个对应的名称，例如<em>LATIN SMALL LETTER A</em>。该抽象字符的图像表现形式（glyph）是<code>a</code>。（译者注：glyph即图像字符）</p>
<blockquote>
<p><strong>代码点</strong>是指被分配给某个抽象字符的数字</p>
</blockquote>
<p>代码点以<code>U+&lt;hex&gt;</code>的形式表示，<code>U+</code>是代表Unicode的前缀，而<code>&lt;hex&gt;</code>是一个16进制数。例如<code>U+0041</code>和<code>U+2603</code>都是代码点。</p>
<p>代码点的取值范围是从<code>U+0000</code>到<code>U+10FFFF</code>。</p>
<p>记住代码点就是一个简单的数字。思考有关Unicode的问题时要记得这一点。</p>
<p>代码点就好像数组元素的下标。</p>
<p>Unicode的神奇之处就在于将代码点与抽象字符关联起来。例如<code>U+0041</code>对应的抽象字符名为<em>LATIN CAPITAL LETTER A</em> (表现为<code>A</code>)，而<code>U+2603</code>对应的抽象字符名为<em>SNOWMAN</em>(表现为<code>☃</code>)</p>
<p>注意，并非所有的代码点都有对应的抽象字符。可用的代码点有1114112个，但分配了抽象字符的只有128237个。</p>
<h2 id="2-2-Unicode平面"><a href="#2-2-Unicode平面" class="headerlink" title="2.2 Unicode平面"></a>2.2 Unicode平面</h2><blockquote>
<p><strong>平面</strong>是指从<code>U+n0000</code>到<code>U+nFFFF</code>的区间，也就是65536（10000<sup>16</sup>）个连续的Unicode代码点，n的取值范围是从0<sup>16</sup>到10<sup>16</sup>。</p>
</blockquote>
<p>这些平面将Unicode代码点分为17个大小相等的集合：</p>
<ul>
<li><p>平面0包含从<code>U+0000</code>到<code>U+FFFF</code>的代码点 </p>
</li>
<li><p>平面1包含从<code>U+**1**0000</code>到<code>U+**1**FFFF</code>的代码点 </p>
</li>
<li><p>…</p>
</li>
<li><p>平面16包含从<code>U+**10**0000</code>到<code>U+**10**FFFF</code>的代码点</p>
</li>
</ul>
<p><img src="http://p0.qhimg.com/t0111a133814cbe5ae1.png" alt="Unicode planes"></p>
<h4 id="基本多文种平面"><a href="#基本多文种平面" class="headerlink" title="基本多文种平面"></a>基本多文种平面</h4><p>平面0比较特殊，被称为<strong>基本多文种平面</strong>或简称<strong>BMP</strong>。它包含了大多数现代语言的字符 (<a href="https://en.wikipedia.org/wiki/Basic_Latin_(Unicode_block" target="_blank" rel="external">基本拉丁字母</a>, <a href="https://en.wikipedia.org/wiki/Cyrillic_(Unicode_block" target="_blank" rel="external">西里尔字母</a>, <a href="https://en.wikipedia.org/wiki/Greek_and_Coptic" target="_blank" rel="external">希腊字母</a>等)和大量的<a href="https://en.wikipedia.org/wiki/Unicode_symbols" target="_blank" rel="external">符号</a>。</p>
<p>如上文所述，基本多文种平面的代码点取值范围是从<code>U+0000</code>到<code>U+FFFF</code>，最多可以有4位16进制数字。</p>
<p>大多数时候开发者处理的都是BMP中的字符。它包含了大多数情况下的必需字符。</p>
<p>BMP中的一些字符：</p>
<ul>
<li><p><code>e</code>对应代码点<code>U+0065</code> 抽象字符名： <em>LATIN SMALL LETTER E</em></p>
</li>
<li><p><code>|</code>对应代码点<code>U+007C</code> 抽象字符名： <em>VERTICAL BAR</em></p>
</li>
<li><p><code>■</code>对应代码点<code>U+25A0</code> 抽象字符名： <em>BLACK SQUARE</em></p>
</li>
<li><p><code>☂</code>对应代码点<code>U+2602</code> 抽象字符名： <em>UMBRELLA</em></p>
</li>
</ul>
<h4 id="星光平面"><a href="#星光平面" class="headerlink" title="星光平面"></a>星光平面</h4><p>BMP之后的16个平面（平面1，平面2，…，平面16）被称为<strong>星光平面</strong>或<strong>辅助平面</strong>。</p>
<p>星光平面的代码点被称为<strong>星光代码点</strong>。这些代码点的取值范围是从<code>U+10000</code>到<code>U+10FFFF</code>。                                     </p>
<p>星光代码点可能会有5位或6位16进制数字：<code>U+ddddd</code>或<code>U+dddddd</code>。</p>
<p>来看几个星光平面里的字符：</p>
<ul>
<li><p><code>?</code>对应<code>U+1D11E</code>抽象字符名：<em>MUSICAL SYMBOL G CLEF</em></p>
</li>
<li><p><code>?</code>对应<code>U+1D401</code>抽象字符名：<em>MATHEMATICAL BOLD CAPITAL B</em></p>
</li>
<li><p><code>?</code>对应<code>U+1F035</code>抽象字符名：<em>DOMINO TITLE HORIZONTAL-00-04</em></p>
</li>
<li><p><code>?</code>对应<code>U+1F600</code>抽象字符名：<em>GRINNING FACE</em></p>
</li>
</ul>
<h2 id="2-3-码元"><a href="#2-3-码元" class="headerlink" title="2.3 码元"></a>2.3 码元</h2><p>计算机在存储时当然不会使用代码点或抽象字符，它们是存在于开发者大脑中的概念。</p>
<p>所以自然要有一种在物理层面表示Unicode代码点的方式：码元。</p>
<blockquote>
<p><strong>码元</strong>是指使用某种给定的编码规则给抽象字符编码后得到的比特序列。</p>
</blockquote>
<p><a href="https://en.wikipedia.org/wiki/Character_encoding" target="_blank" rel="external">字符编码</a>将抽象层面的代码点转换为物理层面的比特序列：码元。</p>
<p>换句话说，字符编码的作用就是将Unicode代码点翻译成独一无二的码元序列。</p>
<p>常用的字符编码有<a href="https://en.wikipedia.org/wiki/UTF-8" target="_blank" rel="external">UTF-8</a>, <a href="https://en.wikipedia.org/wiki/UTF-16" target="_blank" rel="external">UTF-16</a> 和 <a href="https://en.wikipedia.org/wiki/UTF-32" target="_blank" rel="external">UTF-32</a>. </p>
<p>大多数<strong>JavaScript引擎使用UTF-16</strong>编码字符。它会影响JavaScript处理Unicode的方式。所以从这里开始让我们集中精力于UTF-16吧。</p>
<p>UTF-16（全称：16位统一码转换格式）是一种<a href="https://en.wikipedia.org/wiki/Variable-width_encoding" target="_blank" rel="external">变长</a>编码:</p>
<ul>
<li>BMP中的代码点编码为单个16位的码元</li>
<li>星光平面的代码点编码为两个16位的码元</li>
</ul>
<p>来看几个例子</p>
<p>假设我们想把<em>LATIN SMALL LETTER A</em>，也就是抽象字符<code>a</code>存入硬盘。Unicode告诉我们抽象字符<em>LATIN SMALL LETTER A</em>对应代码点<code>U+0061</code>。</p>
<p>现在我们来看看UTF-16如何转换<code>U+0061</code>。编码规范上说，对于BMP中的代码点只需将它的16进制数字U+<strong>0061</strong>存入一个16位的码元就行了。</p>
<p>显然，BMP中的代码点刚好能存进一个16位的码元。编码BMP可谓小菜一碟。</p>
<h2 id="2-4-代理对"><a href="#2-4-代理对" class="headerlink" title="2.4 代理对"></a>2.4 代理对</h2><p>现在让我们来研究一个复杂些的例子。假设我们想存储一个星光代码点（属于星光平面）： <em>GRINNING FACE</em> character <code>?</code>。该字符对应的代码点是 <code>U+1F600</code>。</p>
<p>由于星光代码点需要21个比特来存储字符信息，UTF-16需要<strong>两个码元</strong>来编码，每个16比特。代码点 <code>U+1F600</code> 被拆分为所谓的代理对：<code>0xD83D</code>（高位代理码元）与 <code>0xDE00</code>（低位代理码元）。</p>
<blockquote>
<p><strong>代理对</strong>用来表示那些对应2个16位码元序列的抽象字符，其中第一个码元是<strong>高位代理码元</strong>而第二个是<strong>低位代理码元</strong>。</p>
</blockquote>
<p>编码一个星光代码点需要两个码元：即一个代理对。比如前面那个例子，使用UTF-16编码<code>U+1F600</code> (<code>?</code>)就使用了一个代理对：<code>0xD83D 0xDE00</code>。</p>
<p><a href="https://repl.it/D9RF" target="_blank" rel="external">Try in repl.it</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">`console.log(&apos;\uD83D\uDE00&apos;); // =&gt; &apos;?&apos;`</div></pre></td></tr></table></figure>
<p>高位代理码元的取值范围是从<code>0xD800</code>到<code>0xDBFF</code>。<br>低位代理码元的取值范围是从<code>0xDC00</code>到<code>0xDFFF</code>。</p>
<p>代理对与代码点之间互相转换的算法如下所示：</p>
<p><a href="https://repl.it/DXI0" target="_blank" rel="external">Try in repl.it</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">function getSurrogatePair(astralCodePoint) &#123;  </div><div class="line">  let highSurrogate = </div><div class="line">     Math.floor((astralCodePoint - 0x10000) / 0x400) + 0xD800;</div><div class="line">  let lowSurrogate = (astralCodePoint - 0x10000) % 0x400 + 0xDC00;</div><div class="line">  return [highSurrogate, lowSurrogate];</div><div class="line">&#125;</div><div class="line">getSurrogatePair(0x1F600); // =&gt; [0xDC00, 0xDFFF]</div><div class="line"></div><div class="line">function getAstralCodePoint(highSurrogate, lowSurrogate) &#123;  </div><div class="line">  return (highSurrogate - 0xD800) * 0x400 </div><div class="line">      + lowSurrogate - 0xDC00 + 0x10000;</div><div class="line">&#125;</div><div class="line">getAstralCodePoint(0xD83D, 0xDE00); // =&gt; 0x1F600</div></pre></td></tr></table></figure>
<p>代理对并不是一个令人愉快的东西。在JavaScript中处理字符串时我们必须将它们视为特殊情况来处理，具体内容我们在下章细说。</p>
<p>但UTF-16的存储效率很高。因为99%需要处理的字符都属于BMP，只需要1个码元。</p>
<h2 id="2-5-组合用字符"><a href="#2-5-组合用字符" class="headerlink" title="2.5 组合用字符"></a>2.5 组合用字符</h2><blockquote>
<p>在一个书写系统的上下文中，一个<strong>字素</strong>或者<strong>符号</strong>是最小的可区分单元。</p>
</blockquote>
<p>字素就是用户所认为的一个字符。屏幕上所展示的一个有形的字素称为<strong>图像字符</strong>（glyph）。</p>
<p>在大多数情况下，一个Unicode字符就代表一个字素。例如 <code>U+0066</code> <em>LATIN SMALL LETTER F</em>就是一个英文字母<code>f</code>。</p>
<p>但有时候一个字素会包含一系列字符。</p>
<p>例如<code>å</code>在丹麦语书写系统中是一个不可再分的字素。但它是用<code>U+0061</code> <em>LATIN SMALL LETTER A</em> (渲染为<code>a</code>) 结合一个特殊字符<code>U+030A</code> <a href="https://en.wikipedia.org/wiki/Ring_(diacritic" target="_blank" rel="external"><em>COMBINING RING ABOVE</em></a>（渲染为◌̊）来显示的。</p>
<p><code>U+030A</code>用来修饰前一个字符，这种字符称为<strong>组合用字符</strong>。</p>
<p><a href="https://repl.it/D9RG" target="_blank" rel="external">Try in repl.it</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">console.log(&apos;\u0061\u030A&apos;); // =&gt; &apos;å&apos;  </div><div class="line">console.log(&apos;\u0061&apos;);       // =&gt; &apos;a&apos;</div></pre></td></tr></table></figure>
<blockquote>
<p><strong>组合用字符</strong>是应用在前一个基础字符上以形成完整字素的字符。</p>
</blockquote>
<p>组合用字符包括以下字符：重音符号、变音符、希伯来语点、阿拉伯语元音符号和印度语节拍符。</p>
<p>组合用字符通常不会离开基础字符单独使用。我们应该避免单独显示它们。</p>
<p>与代理对一样，在JavaScript中处理组合用字符也很棘手。</p>
<p>在用户看来一个组合字符序列（基础字符+组合用字符）是【一】个符号（例如<code>&#39;\u0061\u030A&#39;</code>就是<code>&#39;å&#39;</code>）。但开发者必须清楚实际上要用到两个代码点<code>U+0061</code>和<code>U+030A</code>来生成<code>å</code>。</p>
<p><img src="http://p3.qhimg.com/t012c1af4e49cc76519.png" alt="Unicode basic terms"></p>
<h1 id="3-JavaScript中的Unicode"><a href="#3-JavaScript中的Unicode" class="headerlink" title="3. JavaScript中的Unicode"></a>3. JavaScript中的Unicode</h1><p>ES2015规范<a href="http://www.ecma-international.org/ecma-262/6.0/#sec-source-text" target="_blank" rel="external">提到</a>源代码文本使用Unicode（5.1及以上版本）表示。源码文本是一串取值范围从<code>U+0000</code>到<code>U+10FFFF</code>的代码点序列。尽管ECMAScript规范没有指明源码储存和交换的方式，但通常都以UTF-8编码（在web中推荐使用的编码）。</p>
<p>我建议将源代码文本控制在<a href="https://en.wikipedia.org/wiki/Basic_Latin_(Unicode_block" target="_blank" rel="external">Basic Latin Unicode block</a>（或者说ASCII）中。超出ASCII的字符应该避免使用。这能保证源码文本在编码时少出些问题。</p>
<p>ECMAScript 2015在语言层面上给出了JavaScript中String（字符串）的明确<a href="http://www.ecma-international.org/ecma-262/6.0/#sec-ecmascript-language-types-string-type" target="_blank" rel="external">定义</a>：</p>
<p>String类型是由16比特无符号整型数值（“元素”）组成的集合，最少包含0个元素，最多包含2<sup>53</sup>-1个元素。String类型通常用来在运行ECMAScript的程序中表示文本信息，因此String中的每个元素都被当作一个<strong>UTF-16码元</strong>值。</p>
<p>字符串中的每一个元素都会被引擎解释为一个码元。而字符串的渲染结果并不能明确地反映它包含的码元（及其所代表的代码点）。看下面这个例子：</p>
<p><a href="https://repl.it/D9RH" target="_blank" rel="external">Try in repl.it</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">console.log(&apos;cafe\u0301&apos;); // =&gt; &apos;café&apos;  </div><div class="line">console.log(&apos;café&apos;);       // =&gt; &apos;café&apos;</div></pre></td></tr></table></figure>
<p>虽然字面量<code>&#39;cafe\u0301&#39;</code>和<code>&#39;café&#39;</code>有轻微的差别，但两者都被渲染为同样的字符序列<code>café</code>。</p>
<p>字符串的长度是指其中包含的元素（即<strong>16位数值</strong>）的个数。ECMAScript在解释String类型时，字符串的每一个元素都被解释为一个<strong>UTF-16码元</strong>。</p>
<p>从上一章关于代理对和组合用字符的内容可知，某些字符需要2个以上的码元来表示。所以在计算字符长度或通过字符串索引访问字符时要格外小心。</p>
<p><a href="https://repl.it/D9RJ" target="_blank" rel="external">Try in repl.it</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">let smile = &apos;\uD83D\uDE00&apos;;  </div><div class="line">console.log(smile);        // =&gt; &apos;?&apos;  </div><div class="line">console.log(smile.length); // =&gt; 2</div><div class="line"></div><div class="line">let letter = &apos;e\u0301&apos;;  </div><div class="line">console.log(letter);        // =&gt; &apos;é&apos;  </div><div class="line">console.log(letter.length); // =&gt; 2</div></pre></td></tr></table></figure>
<p>字符串<code>smile</code>包含两个码元：<code>\uD83D</code> （高位代理）和<code>\uDE00</code>（低位代理）。由于字符串是码元的序列，因此尽管 <code>smile</code> 的渲染结果只有一个字符<code>&#39;?&#39;</code>，<code>smile.length</code>的值却为<code>2</code>。</p>
<p>对于字符串<code>letter</code>也一样。组合用字符<code>U+0301</code>应用于前一个字符，渲染结果是一个字符<code>&#39;é&#39;</code>。然而<code>letter</code>包含2个码元，因此<code>letter.length</code>值为2。</p>
<p>我的建议是：<strong>始终将JavaScript中的字符串视为一串码元序列</strong>。字符串渲染的结果并不能清晰地表明它包含了怎样的码元。</p>
<p>星光符号和组合字符序列需要2个以上的码元来编码，却被视为一个语素。</p>
<p>如果字符串中含有代理对或组合用字符，而开发者又不清楚这一点，那么在计算字符串长度或通过索引访问字符时就可能会感到困惑。</p>
<p>大多数JavaScript字符串方法都不能识别Unicode。如果字符串含有混合的Unicode字符，在调用<code>myString.slice()</code>、<code>myString.substring()</code>等方法时就要小心了。</p>
<h2 id="3-1-转义序列"><a href="#3-1-转义序列" class="headerlink" title="3.1 转义序列"></a>3.1 转义序列</h2><p>JavaScript字符串中的转义序列通常都是基于代码点数字的。JavaScript有3种转义模式，在ECMAScript 2015中有相关介绍。</p>
<p>来详细看看这几种模式吧。</p>
<h4 id="16进制转义序列"><a href="#16进制转义序列" class="headerlink" title="16进制转义序列"></a>16进制转义序列</h4><p>最简短的形式称为<strong>16进制转义序列</strong>：<code>\x&lt;hex&gt;</code>. <code>\x</code>为前缀，后面跟一个2位的16进制数。</p>
<p>比如<code>&#39;\x30&#39;</code>（字符 <code>&#39;0&#39;</code>）和<code>&#39;\x5B&#39;</code>（字符 <code>&#39;[&#39;</code>）。 </p>
<p>在字符串中使用16进制转义序列如下所示：</p>
<p><a href="https://repl.it/D9RK" target="_blank" rel="external">Try in repl.it</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">var str = &apos;\x4A\x61vaScript&apos;;  </div><div class="line">console.log(str);                    // =&gt; &apos;JavaScript&apos;  </div><div class="line">var reg = /\x4A\x61va.*/;  </div><div class="line">console.log(reg.test(&apos;JavaScript&apos;)); // =&gt; true</div></pre></td></tr></table></figure>
<p>16进制转义序列只能编码从<code>U+00</code>到<code>U+FF</code>的有限数量的代码点，因为它只能有2位数字。但16进制转义序列的好处是它很短。</p>
<h4 id="Unicode转义序列"><a href="#Unicode转义序列" class="headerlink" title="Unicode转义序列"></a>Unicode转义序列</h4><p>如果你想转义整个BMP中的代码点，那就用<strong>Unicode转义序列</strong>。转义形式是<code>\u&lt;hex&gt;</code>,<code>\u</code>为前缀，后面跟一个4位的16进制数。</p>
<p>比如 <code>&#39;\u0051&#39;</code> （字符 <code>&#39;Q&#39;</code>）和<code>&#39;\u222B&#39;</code> （积分符号 <code>&#39;∫&#39;</code>）.</p>
<p>像下面这样使用Unicode转义序列：</p>
<p><a href="https://repl.it/D9RL" target="_blank" rel="external">Try in repl.it</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">var str = &apos;I\u0020learn \u0055nicode&apos;;  </div><div class="line">console.log(str);                 // =&gt; &apos;I learn Unicode&apos;  </div><div class="line">var reg = /\u0055ni.*/;  </div><div class="line">console.log(reg.test(&apos;Unicode&apos;)); // =&gt; true</div></pre></td></tr></table></figure>
<p>Unicode转义序列可以编码从<code>U+0000</code>到<code>U+FFFF</code>的有限数量的代码点（BMP中全部代码点），因为它可以有4位数字。大多数时候这已经足够用来表示常用字符了。</p>
<p>想要在JavaScript文本中表示星光字符，可以用两个连续的Unicode转义序列（高位代理与低位代理），生成代理对：</p>
<p><a href="https://repl.it/D9RM" target="_blank" rel="external">Try in repl.it</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">var str = &apos;My face \uD83D\uDE00&apos;;  </div><div class="line">console.log(str); // =&gt; &apos;My face ?&apos;</div></pre></td></tr></table></figure>
<h4 id="代码点转义序列"><a href="#代码点转义序列" class="headerlink" title="代码点转义序列"></a>代码点转义序列</h4><p>ECMAScript 2015提供了能够表示整个Unicode空间：从<code>U+0000</code>到<code>U+10FFFF</code>，也就是BMP与星光平面的转义序列。</p>
<p>这种新格式被称为<strong>代码点转义序列</strong>：<code>\u{&lt;hex&gt;}</code>，<code>&lt;hex&gt;</code>是一个长度为1至6位的16进制数。<br>比如<code>&#39;\u{7A}&#39;</code>（字符<code>&#39;z&#39;</code>）和<code>&#39;\u{1F639}&#39;</code>（Funny cat符号<code>?</code>）。 </p>
<p>来看看它应该如何应用：</p>
<p><a href="https://repl.it/D9RN" target="_blank" rel="external">Try in repl.it</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">var str = &apos;Funny cat \u&#123;1F639&#125;&apos;;  </div><div class="line">console.log(str);                      // =&gt; &apos;Funny cat ?&apos;  </div><div class="line">var reg = /\u&#123;1F639&#125;/u;  </div><div class="line">console.log(reg.test(&apos;Funny cat ?&apos;)); // =&gt; true</div></pre></td></tr></table></figure>
<p>注意正则表达式<code>/\u{1F639}/u</code>有一个特殊flag<code>u</code>,它支持额外的Unicode特性（详情见3.5正则匹配）。</p>
<p>我喜欢代码点转义不需要使用代理对来表示星光符号这一点。让我们来转义代码点<code>U+1F607</code> <em>SMILING FACE WITH HALO</em>吧：<br><a href="https://repl.it/D9RR" target="_blank" rel="external">Try in repl.it</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">var niceEmoticon = &apos;\u&#123;1F607&#125;&apos;;  </div><div class="line">console.log(niceEmoticon);   // =&gt; &apos;?&apos;  </div><div class="line">var spNiceEmoticon = &apos;\uD83D\uDE07&apos;  </div><div class="line">console.log(spNiceEmoticon); // =&gt; &apos;?&apos;  </div><div class="line">console.log(niceEmoticon === spNiceEmoticon); // =&gt; true</div></pre></td></tr></table></figure>
<p>被赋给变量<code>niceEmoticon</code>的字符串字面量包含一个代码点转义序列<code>&#39;\u{1F607}&#39;</code>，它表示一个星光代码点<code>U+1F607</code>。</p>
<p>然而在这种表象之下代码点转义序列依旧生成了一个代理对（2个码元）。我们可以看到变量<code>spNiceEmoticon</code>被赋值为使用代理对创建的Unicode转义序列<code>&#39;\uD83D\uDE07&#39;</code>，而它与变量<code>niceEmoticon</code>是相等的。</p>
<p><img src="http://p5.qhimg.com/t0198d5591a698acbde.png" alt="Unicode escape sequences JavaScript"></p>
<p>如果正则表达式是用构造函数<code>RegExp</code>创建的，那么在字符串字面量中必须将每一个 <code>\</code> 替换为<code>\\</code>来表示Unicode转义序列。</p>
<p>以下正则表达式对象是相等的：</p>
<p><a href="https://repl.it/D9RS" target="_blank" rel="external">Try in repl.it</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var reg1 = /\x4A \u0020 \u&#123;1F639&#125;/;  </div><div class="line">var reg2 = new RegExp(&apos;\\x4A \\u0020 \\u&#123;1F639&#125;&apos;);  </div><div class="line">console.log(reg1.source === reg2.source); // =&gt; true</div></pre></td></tr></table></figure>
<h2 id="3-2-字符串比较"><a href="#3-2-字符串比较" class="headerlink" title="3.2 字符串比较"></a>3.2 字符串比较</h2><p>JavaScript中的字符串是码元的序列。因此字符串的比较可以看作是码元的计算与匹配。</p>
<p>这种方法快速而有效，对于“简单”的字符串不失为一种好方法。</p>
<p><a href="https://repl.it/D9RU" target="_blank" rel="external">Try in repl.it</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var firstStr = &apos;hello&apos;;  </div><div class="line">var secondStr = &apos;\u0068ell\u006F&apos;;  </div><div class="line">console.log(firstStr === secondStr); // =&gt; true</div></pre></td></tr></table></figure>
<p>字符串<code>firstStr</code>与<code>secondStr</code>包含相同的码元序列，故它们相等。</p>
<p>假设你想比较两个渲染结果相同，但包含不同码元序列的字符串。</p>
<p>那么你可能会得到意外的结果，因为看上去相同的字符串经过比较却不相等：</p>
<p><a href="https://repl.it/D0FG" target="_blank" rel="external">Try in repl.it</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">var str1 = &apos;ça va bien&apos;;  </div><div class="line">var str2 = &apos;c\u0327a va bien&apos;;  </div><div class="line">console.log(str1);          // =&gt; &apos;ça va bien&apos;  </div><div class="line">console.log(str2);          // =&gt; &apos;ça va bien&apos;  </div><div class="line">console.log(str1 === str2); // =&gt; false</div></pre></td></tr></table></figure>
<p><code>str1</code>和<code>str2</code>渲染结果看起来相同，但包含不同的码元。</p>
<p>因为字素<code>ç</code>可以通过两种方法生成：</p>
<ul>
<li><p>使用<code>U+00E7</code> <em>LATIN SMALL LETTER C WITH CEDILLA</em></p>
</li>
<li><p>或者用组合字符序列：<code>U+0063</code> <em>LATIN SMALL LETTER C</em> 加上组合用字符<code>U+0327</code> <em>COMBINING CEDILLA</em>.  </p>
</li>
</ul>
<p>那么该如何处理这种情况，正确地比较字符串？答案是字符串标准化。</p>
<h4 id="标准化"><a href="#标准化" class="headerlink" title="标准化"></a>标准化</h4><blockquote>
<p><strong>标准化</strong>是指将字符串转换为统一的表示形式，以保证具有标准等价性（或兼容等价性）的字符串只有一种表示形式。</p>
</blockquote>
<p>换句话说，当字符串包含组合用字符序列或其他混合结构等复杂的结构时，我们可以将它<em>统一</em>成标准的形式。标准化的字符串在进行比较或文本查找等操作时就很轻松了。</p>
<p><a href="http://unicode.org/reports/tr15/" target="_blank" rel="external">Unicode Standard Annex #15</a>对标准化方法有详细地描述。</p>
<p>在JavaScript中对字符串进行标准化需要调用ES2015提供的<code>myString.normalize([normForm])</code>方法。<code>normForm</code>是一个可选参数（默认为<code>&#39;NFC&#39;</code>），取值为以下标准化模式之一：</p>
<ul>
<li><p><code>&#39;NFC&#39;</code> as Normalization Form Canonical Composition（标准化形式-标准性合成）</p>
</li>
<li><p><code>&#39;NFD&#39;</code> as Normalization Form Canonical Decomposition（标准化形式-标准性分解）</p>
</li>
<li><p><code>&#39;NFKC&#39;</code> as Normalization Form Compatibility Composition（标准化形式-兼容性合成）</p>
</li>
<li><p><code>&#39;NFKD&#39;</code> as Normalization Form Compatibility Decomposition（标准化形式-兼容性分解）</p>
</li>
</ul>
<p>让我们利用字符串标准化来改进上面的例子吧，这次可以正确地比较字符串了：</p>
<p><a href="https://repl.it/D9RV" target="_blank" rel="external">Try in repl.it</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">var str1 = &apos;ça va bien&apos;;  </div><div class="line">var str2 = &apos;c\u0327a va bien&apos;;  </div><div class="line">console.log(str1 === str2.normalize()); // =&gt; true  </div><div class="line">console.log(str1 === str2);             // =&gt; false</div></pre></td></tr></table></figure>
<p><code>&#39;ç&#39;</code>与<code>&#39;c\u0327&#39;</code>具有标准等价性。 </p>
<p>调用<code>str2.normalize()</code>，会返回一个<code>str2</code> 的标准形式副本（<code>&#39;c\u0327&#39;</code>替换为<code>&#39;ç&#39;</code>）。因此比较语句<code>str1 === str2.normalize()</code>会如预期一般返回<code>true</code>.</p>
<p><code>str1</code>不受标准化影响，因为它已经是标准形式了。</p>
<p>但为了使操作符两端都取得标准化字符串，将待比较的2个字符串都标准化也是合理的。</p>
<h2 id="3-3-字符串长度"><a href="#3-3-字符串长度" class="headerlink" title="3.3 字符串长度"></a>3.3 字符串长度</h2><p>想要知道一个字符串的长度通常我们会访问<code>myString.length</code>这个属性。该属性表明了字符串中包含的码元个数。</p>
<p>对于只包含BMP代码点的字符串来说获取字符串长度通常都能符合预期：</p>
<p><a href="https://repl.it/D9RW" target="_blank" rel="external">Try in repl.it</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">var color = &apos;Green&apos;;  </div><div class="line">console.log(color.length); // =&gt; 5</div></pre></td></tr></table></figure>
<p><code>color</code>中的每个码元都对应着一个字素。预期的字符串长度为<code>5</code>.</p>
<h4 id="长度与代理对"><a href="#长度与代理对" class="headerlink" title="长度与代理对"></a>长度与代理对</h4><p>当字符串中包含用来表示星光代码点的代理对时，事情就变得不对劲了。因为每个代理对包含2个码元（一个高位代理和一个低位代理），length属性值会比预期值要大。</p>
<p>比如这个例子：</p>
<p><a href="https://repl.it/D9RY" target="_blank" rel="external">Try in repl.it</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var str = &apos;cat\u&#123;1F639&#125;&apos;;  </div><div class="line">console.log(str);        // =&gt; &apos;cat?&apos;  </div><div class="line">console.log(str.length); // =&gt; 5</div></pre></td></tr></table></figure>
<p>字符串<code>str</code>的渲染结果是4个字符<code>cat?</code>。</p>
<p>然而<code>smile.length</code>等于<code>5</code>，因为<code>U+1F639</code>是一个星光代码点，它被编码成了2个码元（一个代理对）。</p>
<p>不幸的是目前还没有一种高性能的原生方法能解决这个问题。</p>
<p>但至少ECMAScript 2015引入了一种能够识别星光字符的算法。星光字符即使被编译为2个码元，也会被计算为一个字符。</p>
<p>这个能够识别Unicode的利器就是字符迭代器<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/@@iterator" target="_blank" rel="external"><code>String.prototype[@@iterator]()</code></a>。你可以给字符串加上扩展操作符<code>[...str]</code>或<code>Array.from(str)</code>函数（两者都会调用字符串迭代器）。然后再计算返回数组中的字符个数。</p>
<p>需要注意的是这个解决方案如果大量使用可能会造成轻微的性能损失。</p>
<p>让我们用这个扩展操作符来改进上面的例子吧：</p>
<p><a href="https://repl.it/D9RZ" target="_blank" rel="external">Try in repl.it</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">var str = &apos;cat\u&#123;1F639&#125;&apos;;  </div><div class="line">console.log(str);             // =&gt; &apos;cat?&apos;  </div><div class="line">console.log([...str]);        // =&gt; [&apos;c&apos;, &apos;a&apos;, &apos;t&apos;, &apos;?&apos;]  </div><div class="line">console.log([...str].length); // =&gt; 4</div></pre></td></tr></table></figure>
<p><code>[...str]</code>创建了一个包含4个字符的数组。编码<code>U+1F639</code> <em>CAT FACE WITH TEARS OF JOY</em> ?的代理对原封不动地保留了下来，因为字符串迭代器能够识别Unicode。</p>
<h4 id="长度与组合用字符"><a href="#长度与组合用字符" class="headerlink" title="长度与组合用字符"></a>长度与组合用字符</h4><p>那么组合字符序列呢？由于每个组合用字符都是一个码元，因此你会遇到同样的困难。</p>
<p>这个问题对于标准化的字符串可以不用担心。如果运气好，组合字符序列会被标准化为单个字符。我们来试试看：</p>
<p><a href="https://repl.it/D9R1" target="_blank" rel="external">Try in repl.it</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">var drink = &apos;cafe\u0301&apos;;  </div><div class="line">console.log(drink);                    // =&gt; &apos;café&apos;  </div><div class="line">console.log(drink.length);             // =&gt; 5  </div><div class="line">console.log(drink.normalize())         // =&gt; &apos;café&apos;  </div><div class="line">console.log(drink.normalize().length); // =&gt; 4</div></pre></td></tr></table></figure>
<p>字符串<code>drink</code>包含5个码元（因此<code>drink.length</code>等于<code>5</code>），尽管它只显示4个字符。</p>
<p>在标准化<code>drink</code>时，我们幸运地发现组合字符序列<code>&#39;e\u0301&#39;</code>有标准形式<code>&#39;é&#39;</code>。因此<code>drink.normalize().length</code>返回了预期的<code>4</code>。</p>
<p>不幸的是标准化并不能解决所有问题。那些比较长的组合字符序列并不都有对应的单个字符标准形式。比如这个例子：</p>
<p><a href="https://repl.it/D9R4" target="_blank" rel="external">Try in repl.it</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">var drink = &apos;cafe\u0327\u0301&apos;;  </div><div class="line">console.log(drink);                    // =&gt; &apos;cafȩ́&apos;  </div><div class="line">console.log(drink.length);             // =&gt; 6  </div><div class="line">console.log(drink.normalize());        // =&gt; &apos;cafȩ́&apos;  </div><div class="line">console.log(drink.normalize().length); // =&gt; 5</div></pre></td></tr></table></figure>
<p><code>drink</code>包含6个码元所以<code>drink.length</code>值为<code>6</code>。然而<code>drink</code>只包含4个字符。</p>
<p>标准化函数<code>drink.normalize()</code>将组合序列<code>&#39;e\u0327\u0301&#39;</code>转换为含有2个字符的标准形式<code>&#39;ȩ\u0301&#39;</code>（只去掉了一个组合用字符）。于是我们很难过地发现<code>drink.normalize().length</code>的值为<code>5</code>，仍然不能正确地计算字符的个数。</p>
<h2 id="3-4-字符定位"><a href="#3-4-字符定位" class="headerlink" title="3.4 字符定位"></a>3.4 字符定位</h2><p>由于字符串是码元的序列，通过字符串索引来访问字符同样会有困难。</p>
<p>如果字符串只包含BMP字符（除了从<code>U+D800</code>到<code>U+DBFF</code>的高位代理和从<code>U+DC00</code>到<code>U+DFFF</code>的低位代理），字符定位可以得到正确的结果。</p>
<p><a href="https://repl.it/D9R6" target="_blank" rel="external">Try in repl.it</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var str = &apos;hello&apos;;  </div><div class="line">console.log(str[0]); // =&gt; &apos;h&apos;  </div><div class="line">console.log(str[4]); // =&gt; &apos;o&apos;</div></pre></td></tr></table></figure>
<p>上例中每个字符被编码为一个码元，因此通过索引访问字符可以得到正确的结果。</p>
<h4 id="字符定位与代理对"><a href="#字符定位与代理对" class="headerlink" title="字符定位与代理对"></a>字符定位与代理对</h4><p>当字符串中包含星光字符时情况就不一样了。</p>
<p>星光字符被编码为2个码元（一个代理对）。因此通过索引来访问字符可能会返回一个单独的高位代理或低位代理，而单独的高位/低位代理是无效字符。</p>
<p>下面这个例子演示了访问星光字符的情形：</p>
<p><a href="https://repl.it/D9R8/1" target="_blank" rel="external">Try in repl.it</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">var omega = &apos;\u&#123;1D6C0&#125; is omega&apos;;  </div><div class="line">console.log(omega);        // =&gt; &apos;? is omega&apos;  </div><div class="line">console.log(omega[0]);     // =&gt; &apos;&apos; (unprintable symbol)  </div><div class="line">console.log(omega[1]);     // =&gt; &apos;&apos; (unprintable symbol)</div></pre></td></tr></table></figure>
<p>由于<code>U+1D6C0</code> <em>MATHEMATICAL BOLD CAPITAL OMEGA</em>是一个星光字符，它的编码使用了一个代理对，即2个码元。</p>
<p><code>omega[0]</code>访问的是高位代理码元而<code>omega[1]</code>访问的是低位代理码元，代理对被分成了两半。</p>
<p>想要正确地访问字符串中星光字符，有2种方法：</p>
<ul>
<li><p>使用能够识别Unicode的字符串迭代器生成一个字符数组<code>[...str][index]</code></p>
</li>
<li><p>用<code>number = myString.codePointAt(index)</code>获取代码点，然后用<code>String.fromCodePoint(number)</code>将代码点转换为字符（推荐方法）</p>
</li>
</ul>
<p>让我们来尝试一下这两种方法：</p>
<p><a href="https://repl.it/D9Ra" target="_blank" rel="external">Try in repl.it</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">var omega = &apos;\u&#123;1D6C0&#125; is omega&apos;;  </div><div class="line">console.log(omega);                        // =&gt; &apos;? is omega&apos;  </div><div class="line">// Option 1</div><div class="line">console.log([...omega][0]);                // =&gt; &apos;?&apos;  </div><div class="line">// Option 2</div><div class="line">var number = omega.codePointAt(0);  </div><div class="line">console.log(number.toString(16));          // =&gt; &apos;1d6c0&apos;  </div><div class="line">console.log(String.fromCodePoint(number)); // =&gt; &apos;?&apos;</div></pre></td></tr></table></figure>
<p><code>[...smile]</code>返回一个包含字符串<code>omega</code>中字符的数组。代理对被正确识别，因此访问第一个字符返回了符合预期的结果：<code>[...smile][0]</code>返回<code>&#39;?&#39;</code>.</p>
<p>函数<code>omega.codePointAt(0)</code>能够识别Unicode，因此它返回了字符串<code>omega</code>第一个字符的星光代码点数字<code>0x1D6C0</code>。函数<code>String.fromCodePoint(number)</code>则返回了这个代码点对应的字符：<code>&#39;?&#39;</code>。</p>
<h4 id="字符定位与组合用字符"><a href="#字符定位与组合用字符" class="headerlink" title="字符定位与组合用字符"></a>字符定位与组合用字符</h4><p>字符定位在遇到组合用字符时会出现和上面一样的问题。</p>
<p>通过索引访问字符实际上是访问码元。然而组合字符序列应该被整体访问，而不是被分成单个的码元。</p>
<p>下面这个例子演示了这个问题：</p>
<p><a href="https://repl.it/D9Rb" target="_blank" rel="external">Try in repl.it</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">var drink = &apos;cafe\u0301&apos;;  </div><div class="line">console.log(drink);        // =&gt; &apos;café&apos;  </div><div class="line">console.log(drink.length); // =&gt; 5  </div><div class="line">console.log(drink[3]);     // =&gt; &apos;e&apos;  </div><div class="line">console.log(drink[4]);     // =&gt; ◌́</div></pre></td></tr></table></figure>
<p><code>drink[3]</code>只访问到了基础字符<code>e</code>,没有包括组合用字符<code>U+0301</code> <em>COMBINING ACUTE ACCENT</em>（渲染为◌́ ）。</p>
<p><code>drink[4]</code>访问的是独立的组合用字符◌́ 。</p>
<p>这种情况需要使用字符串标准化。组合字符序列<code>U+0065</code> <em>LATIN SMALL LETTER E</em> + <code>U+0301</code> <em>COMBINING ACUTE ACCENT</em>有对应的标准形式<code>U+00E9</code> <em>LATIN SMALL LETTER E WITH ACUTE</em> <code>é</code></p>
<p>我们来改进一下前面的例子：</p>
<p><a href="https://repl.it/D9Rc" target="_blank" rel="external">Try in repl.it</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">var drink = &apos;cafe\u0301&apos;;  </div><div class="line">console.log(drink.normalize());        // =&gt; &apos;café&apos;  </div><div class="line">console.log(drink.normalize().length); // =&gt; 4  </div><div class="line">console.log(drink.normalize()[3]);     // =&gt; &apos;é&apos;</div></pre></td></tr></table></figure>
<p>需要注意的是并非所有组合字符序列都有对应的单个标准字符。因此标准化并不能解决所有问题。</p>
<p>好在对于欧洲/北美语言来说它可以解决大部分问题。</p>
<h2 id="3-5-正则匹配"><a href="#3-5-正则匹配" class="headerlink" title="3.5 正则匹配"></a>3.5 正则匹配</h2><p>正则表达式与字符串一样，是基于码元工作的。因此与上文描述的情形相似，使用正则表达式在处理代理对和组合字符序列时也会遇到困难。</p>
<p>BMP字符的匹配是符合预期的，因为一个码元对应一个字符：</p>
<p><a href="https://repl.it/D9Re" target="_blank" rel="external">Try in repl.it</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var greetings = &apos;Hi!&apos;;  </div><div class="line">var regex = /.&#123;3&#125;/;  </div><div class="line">console.log(regex.test(greetings)); // =&gt; true</div></pre></td></tr></table></figure>
<p><code>greetings</code>有3个字符，编码为3个码元。正则表达式<code>/.{3}/</code>期望的是3个码元，因此与<code>greetings</code>匹配成功。</p>
<p>在匹配星光字符（被编码为2个码元的代理对）时，你可能会遇到困难：</p>
<p><a href="https://repl.it/D9Rg" target="_blank" rel="external">Try in repl.it</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var smile = &apos;?&apos;;  </div><div class="line">var regex = /^.$/;  </div><div class="line">console.log(regex.test(smile)); // =&gt; false</div></pre></td></tr></table></figure>
<p><code>smile</code>包含星光字符<code>U+1F600</code> <em>GRINNING FACE</em>。<code>U+1F600</code>被编码为一个代理对<code>0xD83D 0xDE00</code>。</p>
<p>然而正则表达式<code>/^.$/</code>期望的是1个码元，于是正则匹配<code>regexp.test(smile)</code>失败了。</p>
<p>在定义字符区间的时候情况会更糟。JavaScript直接报错了：</p>
<p><a href="https://repl.it/D9Rh" target="_blank" rel="external">Try in repl.it</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var regex = /[?-?]/;  </div><div class="line">// =&gt; SyntaxError: Invalid regular expression: /[?-?]/: </div><div class="line">// Range out of order in character class</div></pre></td></tr></table></figure>
<p>星光代码点会被编码为代理对，因此JavaScript会用码元<code>/[\uD83D\uDE00-\uD83D\uDE0E]/</code>来表示这个正则表达式。而在pattern中每个码元被视为一个单独的元素，所以正则表达式会忽略代理对这个概念。</p>
<p>又由于<code>\uDE00</code>比<code>\uD83D</code>大，<code>\uDE00-\uD83D</code>这个字符区间是无效的，所以就报错了。</p>
<h4 id="正则表达式-u-标志"><a href="#正则表达式-u-标志" class="headerlink" title="正则表达式 u 标志"></a>正则表达式 <code>u</code> 标志</h4><p>好在ECMAScript 2015引入了<code>u</code>标志，使得正则表达式能够识别Unicode。这个标志让我们能够正确处理星光字符。</p>
<p>在正则表达式中可以使用Unicode转义序列<code>/u{1F600}/u</code>。这样比写高位代理和低位代理<code>/\uD83D\uDE00/</code>要短。</p>
<p>让我们来尝试应用一下<code>u</code>标志，看看<code>.</code>操作符（包括量词<code>?</code>、<code>+</code>、<code>*</code>和<code>{3}</code>、<code>{3,}</code>, <code>{2,3}</code>）能否匹配星光字符：</p>
<p><a href="https://repl.it/D9Ri" target="_blank" rel="external">Try in repl.it</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">var smile = &apos;?&apos;;  </div><div class="line">var regex = /^.$/u;  </div><div class="line">console.log(regex.test(smile)); // =&gt; true</div></pre></td></tr></table></figure>
<p>正则表达式<code>/^.$/u</code>由于加上了<code>u</code>标志而能够识别Unicode，因此正确地匹配了星光字符。</p>
<p><code>u</code>标志还能使星光字符区间被正确处理：</p>
<p><a href="https://repl.it/D9Rm" target="_blank" rel="external">Try in repl.it</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">var smile = &apos;?&apos;;  </div><div class="line">var regex = /[?-?]/u;  </div><div class="line">var regexEscape = /[\u&#123;1F600&#125;-\u&#123;1F60E&#125;]/u;  </div><div class="line">var regexSpEscape = /[\uD83D\uDE00-\uD83D\uDE0E]/u;  </div><div class="line">console.log(regex.test(smile));         // =&gt; true  </div><div class="line">console.log(regexEscape.test(smile));   // =&gt; true  </div><div class="line">console.log(regexSpEscape.test(smile)); // =&gt; true</div></pre></td></tr></table></figure>
<p>现在<code>[?-?]</code>被视为一个星光字符的区间了。<code>/[?-?]/u</code>成功匹配了<code>&#39;?&#39;</code>。</p>
<h4 id="正则表达式与组合用字符"><a href="#正则表达式与组合用字符" class="headerlink" title="正则表达式与组合用字符"></a>正则表达式与组合用字符</h4><p>不幸的是不论有没有<code>u</code>标志，正则表达式都会把组合用标记视为独立的码元来处理。</p>
<p>要匹配组合字符序列，只能分别匹配基础字符与组合用字符。</p>
<p>看下面的例子：</p>
<p><a href="https://repl.it/D9Rp" target="_blank" rel="external">Try in repl.it</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">var drink = &apos;cafe\u0301&apos;;  </div><div class="line">var regex1 = /^.&#123;4&#125;$/;  </div><div class="line">var regex2 = /^.&#123;5&#125;$/;  </div><div class="line">console.log(drink);              // =&gt; &apos;café&apos;  </div><div class="line">console.log(regex1.test(drink)); // =&gt; false  </div><div class="line">console.log(regex2.test(drink)); // =&gt; true</div></pre></td></tr></table></figure>
<p>字符串渲染为4个字符<code>café</code>。</p>
<p>然而成功匹配<code>&#39;cafe\u0301&#39;</code>的正则表达式是匹配5个元素的<code>/^.{5}$/</code>。</p>
<h1 id="4-结语"><a href="#4-结语" class="headerlink" title="4. 结语"></a>4. 结语</h1><p>也许在JavaScript中有关Unicode的最重要的概念就是<strong>将字符串视为码元序列</strong>，事实也确实如此。</p>
<p>如果开发者认为字符串是由字素（或字符）组成，忽略码元序列这个概念，就会感到困惑。</p>
<p>在处理包含代理对或组合字符序列的字符串时这种想法会造成误解。</p>
<ul>
<li><p>获取字符串长度</p>
</li>
<li><p>字符定位</p>
</li>
<li><p>正则匹配</p>
</li>
</ul>
<p>注意JavaScript中大多数字符串方法都不能识别Unicode：比如<code>myString.indexOf()</code>、<code>myString.slice()</code>等。</p>
<p>ECMAScript 2015在字符串和正则表达式中增加了一些很棒的特性，例如代码点转义序列<code>\u{1F600}</code>。</p>
<p>新的正则表达式标志<code>u</code>使字符串匹配能够识别Unicode，这样一来匹配星光字符就简单多了。</p>
<p>字符串迭代器<code>String.prototype[@@iterator]()</code>能够识别Unicode。使用扩展操作符<code>[...str]</code>或<code>Array.from(str)</code>可以创建一个字符数组，通过这个数组的下标来计算字符串长度或访问字符就不会把代理对拆开了。但要注意这种方法会影响性能。</p>
<p>如果你需要更好的办法来处理Unicode字符，你可以使用<a href="https://github.com/bestiejs/punycode.js/" target="_blank" rel="external">punycode</a>库或者<a href="https://github.com/mathiasbynens/regenerate" target="_blank" rel="external">生成</a>特殊的正则表达式。</p>
<p>但愿此文能帮助你掌握Unicode！</p>
<blockquote>
<p>本文转载自：<a href="http://www.zcfy.cc" target="_blank" rel="external">众成翻译</a><br>译者：<a href="http://www.zcfy.cc/@tutaizi" target="_blank" rel="external">兔子</a><br>链接：<a href="http://www.zcfy.cc/article/1303" target="_blank" rel="external">http://www.zcfy.cc/article/1303</a><br>原文：<a href="https://rainsoft.io/what-every-javascript-developer-should-know-about-unicode/" target="_blank" rel="external">https://rainsoft.io/what-every-javascript-developer-should-know-about-unicode/</a></p>
</blockquote>

      
    </div>
    
  </div>
  
    
    <div class="copyright">
        <p><span>本文标题:</span><a href="/2016/12/11/每个JavaScript开发者都该懂的Unicode/">每个JavaScript开发者都该懂的Unicode</a></p>
        <p><span>文章作者:</span><a href="/" title="回到主页">jsgr</a></p>
        <p><span>发布时间:</span>2016-12-11, 11:28:07</p>
        <p><span>最后更新:</span>2016-12-11, 11:30:21</p>
        <p>
            <span>原始链接:</span><a class="post-url" href="/2016/12/11/每个JavaScript开发者都该懂的Unicode/" title="每个JavaScript开发者都该懂的Unicode">http://jsgrblog.win/2016/12/11/每个JavaScript开发者都该懂的Unicode/</a>
            <span class="copy-path" data-clipboard-text="原文: http://jsgrblog.win/2016/12/11/每个JavaScript开发者都该懂的Unicode/　　作者: jsgr" title="点击复制文章链接"><i class="fa fa-clipboard"></i></span>
            <script> var clipboard = new Clipboard('.copy-path'); </script>
        </p>
        <p>
            <span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" title="CC BY-NC-SA 4.0 International" target = "_blank">"署名-非商用-相同方式共享 4.0"</a> 转载请保留原文链接及作者。
        </p>
    </div>



    <nav id="article-nav">
        
        
            <div id="article-nav-older" class="article-nav-title">
                <a href="/2016/12/11/jQuery还有意义吗/">
                    jQuery还有意义吗
                </a>
            </div>
        
    </nav>

  
</article>

    <div id="toc" class="toc-article">
        <strong class="toc-title">文章目录</strong>
        
            <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#1-Unicode背后的思想"><span class="toc-number">1.</span> <span class="toc-text">1. Unicode背后的思想</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-Unicode基本概念"><span class="toc-number">2.</span> <span class="toc-text">2. Unicode基本概念</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-字符与代码点"><span class="toc-number">2.1.</span> <span class="toc-text">2.1 字符与代码点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-Unicode平面"><span class="toc-number">2.2.</span> <span class="toc-text">2.2 Unicode平面</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#基本多文种平面"><span class="toc-number">2.2.0.1.</span> <span class="toc-text">基本多文种平面</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#星光平面"><span class="toc-number">2.2.0.2.</span> <span class="toc-text">星光平面</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-码元"><span class="toc-number">2.3.</span> <span class="toc-text">2.3 码元</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-代理对"><span class="toc-number">2.4.</span> <span class="toc-text">2.4 代理对</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-5-组合用字符"><span class="toc-number">2.5.</span> <span class="toc-text">2.5 组合用字符</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-JavaScript中的Unicode"><span class="toc-number">3.</span> <span class="toc-text">3. JavaScript中的Unicode</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-转义序列"><span class="toc-number">3.1.</span> <span class="toc-text">3.1 转义序列</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#16进制转义序列"><span class="toc-number">3.1.0.1.</span> <span class="toc-text">16进制转义序列</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Unicode转义序列"><span class="toc-number">3.1.0.2.</span> <span class="toc-text">Unicode转义序列</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#代码点转义序列"><span class="toc-number">3.1.0.3.</span> <span class="toc-text">代码点转义序列</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-字符串比较"><span class="toc-number">3.2.</span> <span class="toc-text">3.2 字符串比较</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#标准化"><span class="toc-number">3.2.0.1.</span> <span class="toc-text">标准化</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-字符串长度"><span class="toc-number">3.3.</span> <span class="toc-text">3.3 字符串长度</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#长度与代理对"><span class="toc-number">3.3.0.1.</span> <span class="toc-text">长度与代理对</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#长度与组合用字符"><span class="toc-number">3.3.0.2.</span> <span class="toc-text">长度与组合用字符</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-字符定位"><span class="toc-number">3.4.</span> <span class="toc-text">3.4 字符定位</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#字符定位与代理对"><span class="toc-number">3.4.0.1.</span> <span class="toc-text">字符定位与代理对</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#字符定位与组合用字符"><span class="toc-number">3.4.0.2.</span> <span class="toc-text">字符定位与组合用字符</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-正则匹配"><span class="toc-number">3.5.</span> <span class="toc-text">3.5 正则匹配</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#正则表达式-u-标志"><span class="toc-number">3.5.0.1.</span> <span class="toc-text">正则表达式 u 标志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#正则表达式与组合用字符"><span class="toc-number">3.5.0.2.</span> <span class="toc-text">正则表达式与组合用字符</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-结语"><span class="toc-number">4.</span> <span class="toc-text">4. 结语</span></a></li></ol>
        
    </div>
    <style>
        .left-col .switch-btn,
        .left-col .switch-area {
            display: none;
        }
        .toc-level-3 i,
        .toc-level-3 ol {
            display: none !important;
        }
    </style>

    <input type="button" id="tocButton" value="隐藏目录"  title="点击按钮隐藏或者显示文章目录">

    <script>
        yiliaConfig.toc = ["隐藏目录", "显示目录", !!"false"];
    </script>



    
<div class="share">
    
        <div class="bdsharebuttonbox">
            <a href="#" class="fa fa-twitter bds_twi" data-cmd="twi" title="分享到推特"></a>
            <a href="#" class="fa fa-weibo bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
            <a href="#" class="fa fa-qq bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
            <a href="#" class="fa fa-files-o bds_copy" data-cmd="copy" title="复制网址"></a>
            <a href="#" class="fa fa fa-envelope-o bds_mail" data-cmd="mail" title="通过邮件分享"></a>
            <a href="#" class="fa fa-weixin bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
            <a href="#" class="fa fa-share-alt bds_more" data-cmd="more"></i></a>
        </div>
        <script>
            window._bd_share_config={
                "common":{"bdSnsKey":{},"bdText":"每个JavaScript开发者都该懂的Unicode　| jsgr blog　","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
        </script>
    

    
</div>







    
      <div class="duoshuo" id="comments">
    <div id="comment-box" ></div>
    <div class="ds-thread" id="ds-thread" data-thread-key="2016/12/11/每个JavaScript开发者都该懂的Unicode/" data-title="每个JavaScript开发者都该懂的Unicode" data-url="http://jsgrblog.win/2016/12/11/每个JavaScript开发者都该懂的Unicode/"></div>
    <script>
        var duoshuoQuery = {short_name:"jsgr"};
        var loadComment = function(){
            var d = document, s = d.createElement('script');
            s.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
            s.async = true; s.charset = 'UTF-8';
            (d.head || d.body).appendChild(s);
        }

        
    </script>
    
    <script> loadComment(); </script>

</div>
    




    <div class="scroll" id="post-nav-button">
        
            <a href="/" title="回到主页"><i class="fa fa-home"></i></a>
        

        <a title="文章列表"><i class="fa fa-bars"></i><i class="fa fa-times"></i></a>

        
            <a href="/2016/12/11/jQuery还有意义吗/" title="下一篇: jQuery还有意义吗">
                <i class="fa fa-angle-right"></i>
            </a>
        
    </div>

    <ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2016/12/11/每个JavaScript开发者都该懂的Unicode/">每个JavaScript开发者都该懂的Unicode</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/11/jQuery还有意义吗/">jQuery还有意义吗</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/11/一个治愈JavaScript疲劳的学习计划/">一个治愈JavaScript疲劳的学习计划</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/11/2016年学习JavaScript是怎样的一种体验/">2016年学习JavaScript是怎样的一种体验</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/11/为什么你需要成为一个全栈开发工程师？/">为什么你需要成为一个全栈开发工程师？</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/11/jQuery3-1-0发布–不再隐藏错误/">jQuery3.1.0发布–不再隐藏错误</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/11/jQuery3-0的新特性/">jQuery3.0的新特性</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/11/调试CSS的方法/">调试CSS的方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/10/148个资源让你成为CSS专家/">148个资源让你成为CSS专家</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/10/运动曲线提升CSS动画效果/">运动曲线提升CSS动画效果</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/10/70个老司机技巧教你更好的进行CSS编程/">70个老司机技巧教你更好的进行CSS编程</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/10/使用CSS相对单位构建可缩放的组件/">使用CSS相对单位构建可缩放的组件</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/10/关于css定位，你需要知道的5件事/">关于css定位，你需要知道的5件事</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/10/了解并使用CSS中的rem单位/">了解并使用 CSS 中的 rem 单位</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/10/网页设计和开发的55个顶尖博客/">网页设计和开发的55个顶尖博客</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/10/CSS变量和预处理变量有什么不同？/">CSS变量和预处理变量有什么不同？</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/10/如何创建响应式删格系统/">如何创建响应式删格系统</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/10/既然写CSS很容易，那为什么大家还是把CSS写的那么烂呢？/">既然写CSS很容易，那为什么大家还是把CSS写的那么烂呢？</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/10/流畅web动画的十个法则/">流畅web动画的十个法则</a></li><li class="post-list-item"><a class="post-list-link" href="/2016/12/10/H5-1新特性/">HTML 5.1 里的新东西</a></li></ul>




    <script>
        
    </script>
</div>
      <footer id="footer">
    <div class="outer">
        <div id="footer-info">
            <div class="footer-left">
                <i class="fa fa-copyright"></i> 
                2016 jsgr
            </div>
            <div class="footer-right">
                <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减 Hexo 双栏博客主题  v3.5">Yelee</a> by MOxFIVE <i class="fa fa-heart animated infinite pulse"></i>
            </div>
        </div>
        
            <div class="visit">
                
                    <span id="busuanzi_container_site_pv" style='display:none'>
                        <span id="site-visit" title="本站到访数"><i class="fa fa-user" aria-hidden="true"></i><span id="busuanzi_value_site_uv"></span>
                        </span>
                    </span>
                
                
                    <span>| </span>
                
                
                    <span id="busuanzi_container_page_pv" style='display:none'>
                        <span id="page-visit"  title="本页阅读量"><i class="fa fa-eye animated infinite pulse" aria-hidden="true"></i><span id="busuanzi_value_page_pv"></span>
                        </span>
                    </span>
                
            </div>
        
    </div>
</footer>
    </div>
    
<script data-main="/js/main.js" src="//cdn.bootcss.com/require.js/2.2.0/require.min.js"></script>

    <script>
        $(document).ready(function() {
            var iPad = window.navigator.userAgent.indexOf('iPad');
            if (iPad > -1 || $(".left-col").css("display") === "none") {
                var bgColorList = ["#9db3f4", "#414141", "#e5a859", "#f5dfc6", "#c084a0", "#847e72", "#cd8390", "#996731"];
                var bgColor = Math.ceil(Math.random() * (bgColorList.length - 1));
                $("body").css({"background-color": bgColorList[bgColor], "background-size": "cover"});
            }
            else {
                var backgroundnum = 5;
                var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));
                $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
            }
        })
    </script>





<div class="scroll" id="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" onclick="load$hide();" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>
<script>
    // Open in New Window
    
        var oOpenInNew = {
            
             title: "a.article-title, .article-more-link a", 
             post: ".article-entry a[href], .copyright a[href]", 
             tags: ".article-tag a", 
            
            
             archives: ".archive-article-title", 
             miniArchives: "a.post-list-link", 
            
             friends: "#js-friends a", 
             socail: ".social a" 
        }
        for (var x in oOpenInNew) {
            $(oOpenInNew[x]).attr("target", "_blank");
        }
    
</script>

    <script>
        var originTitle = document.title;
        var titleTime;
        document.addEventListener("visibilitychange", function() {
            if (document.hidden) {
                document.title = "(つェ⊂) 我藏好了哦~ " + originTitle;
                clearTimeout(titleTime);
            }
            else {
                document.title = "(*´∇｀*) 被你发现啦~ " + originTitle;
                titleTime = setTimeout(function() {
                    document.title = originTitle;
                }, 2000);
            }
        })
    </script>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>